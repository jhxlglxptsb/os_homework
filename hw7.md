# lec7\(lab2\) SPOC思考题

## 第七讲视频相关思考题

### 7.1 了解x86保护模式中的特权级

1. X86有几个特权级？
  - 4个特权级

2. 不同特权级有什么区别？
  - 一些指令（特权指令）的执行只能在ring 0
  - 可以访问的数据范围不一样
  - 一条指令在不同的特权级下行为不同

3. 请说明CPL、DPL和RPL在中断响应、函数调用和指令执行时的作用。
  - 访问门时，CPL<=DPL[门], CPL>=DPL[段]
  - 访问段时，MAX(CPL, RPL)<=DPL[段]

### 7.2 了解特权级切换过程

1. 一条指令在执行时会有哪些可能的特权级判断？
  - 判断访问的数据是否是当前特权级可以访问的
  - 判断当前指令需要什么样的特权级
  - 判断当前的特权级能否执行该指令

2. 在什么情况下会出现特权级切换？
  - 中断，系统调用

3. int指令在ring0和ring3的执行行为有什么不同？
  - 在ring3会切换堆栈并将SS和ESP压栈

4. 如何利用int和iret指令完成不同特权级的切换？
  - 在指令执行前构造栈，使之与需要切换的特权级进入中断时的栈相同

5. TSS和Task Register的作用是什么？
  - TSS保存了从ring 0到ring 2这三个特权级里面的堆栈信息
  - Task Register缓存TSS里面的内容

### 7.3 了解段/页表

1. 一条指令执行时最多会出现多少次地址转换？
  - 4次

2. 描述X86-32的MMU地址转换过程；
  - 从段描述符中找到段基址和Offset得到线性地址
  - 线性地址分为三部分，从中得到页目录的地址和偏移，根据多级页表得到最后的地址

### 7.4 了解UCORE建立段/页表

1. 分析MMU的使能过程，尽可能详细地分析在执行进入保护械的代码“movl %eax, %cr0 ; ljmp $CODE_SEL, $0x0”时，CPU的状态和寄存器内容的变化。
  - 

2. 分析页表的建立过程；

## 个人思考题

---

x86保护模式中权限管理无处不在，下面哪些时候要检查访问权限\(\)  \(w4l1\)

* [x] 内存寻址过程中
* [x] 代码跳转过程中
* [x] 中断处理过程中
* [ ] ALU计算过程中

请描述ucore OS建立页机制的准备工作包括哪些步骤？ \(w4l1\)
